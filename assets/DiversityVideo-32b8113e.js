import{c as R,i as Oe,e as N,a as X,n as Y,m as A,b as L,u as me,d as ve,p as fe,f as F,t as he,g as ge,h as Te,j as Se,k as j,l as ee,w as pe,_ as Ve,I as we}from"./plugin-vueexport-helper-fba48285.js";import{u as _e,L as Pe,a as Ee}from"./index-459da6a1.js";/* empty css              *//* empty css              */import{N as Ie}from"./index-ec46faed.js";import{d as q,r as b,c as p,w as De,a as d,b as z,m as Ne,n as te,u as Be,e as He,f as Me,g as $e,o as Re,h as ne,i as E,j as G,F as Ae,k as J,l as oe,t as Q,p as Fe,q as ae,s as le,v as se}from"./index-a7cc648c.js";import{u as Ue}from"./use-touch-32e776f2.js";import{H as ie,B as Le}from"./on-popup-reopen-31dce3e1.js";const[qe,k,ce]=R("picker"),be=e=>e.find(n=>!n.disabled)||e[0];function Ke(e,n){const o=e[0];if(o){if(Array.isArray(o))return"multiple";if(n.children in o)return"cascade"}return"default"}function U(e,n){n=X(n,0,e.length);for(let o=n;o<e.length;o++)if(!e[o].disabled)return o;for(let o=n-1;o>=0;o--)if(!e[o].disabled)return o;return 0}const re=(e,n,o)=>n!==void 0&&!!e.find(r=>r[o.value]===n);function Z(e,n,o){const r=e.findIndex(g=>g[o.value]===n),s=U(e,r);return e[s]}function Ye(e,n,o){const r=[];let s={[n.children]:e},g=0;for(;s&&s[n.children];){const v=s[n.children],u=o.value[g];if(s=Oe(u)?Z(v,u,n):void 0,!s&&v.length){const m=be(v)[n.value];s=Z(v,m,n)}g++,r.push(v)}return r}function je(e){const{transform:n}=window.getComputedStyle(e),o=n.slice(7,n.length-1).split(", ")[5];return Number(o)}function ze(e){return N({text:"text",value:"value",children:"children"},e)}const ue=200,de=300,Ge=15,[ye,W]=R("picker-column"),Ce=Symbol(ye);var Je=q({name:ye,props:{value:Y,fields:A(Object),options:L(),readonly:Boolean,allowHtml:Boolean,optionHeight:A(Number),swipeDuration:A(Y),visibleOptionNum:A(Y)},emits:["change","clickOption","scrollInto"],setup(e,{emit:n,slots:o}){let r,s,g,v,u;const m=b(),y=b(),i=b(0),h=b(0),x=Ue(),O=()=>e.options.length,I=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,C=c=>{let t=U(e.options,c);const a=-t*e.optionHeight,l=()=>{t>O()-1&&(t=U(e.options,c));const V=e.options[t][e.fields.value];V!==e.value&&n("change",V)};r&&a!==i.value?u=l:l(),i.value=a},f=()=>e.readonly||!e.options.length,_=c=>{r||f()||(u=null,h.value=ue,C(c),n("clickOption",e.options[c]))},T=c=>X(Math.round(-c/e.optionHeight),0,O()-1),S=p(()=>T(i.value)),B=(c,t)=>{const a=Math.abs(c/t);c=i.value+a/.003*(c<0?-1:1);const l=T(c);h.value=+e.swipeDuration,C(l)},w=()=>{r=!1,h.value=0,u&&(u(),u=null)},H=c=>{if(!f()){if(x.start(c),r){const t=je(y.value);i.value=Math.min(0,t-I())}h.value=0,s=i.value,g=Date.now(),v=s,u=null}},P=c=>{if(f())return;x.move(c),x.isVertical()&&(r=!0,fe(c,!0));const t=X(s+x.deltaY.value,-(O()*e.optionHeight),e.optionHeight),a=T(t);a!==S.value&&n("scrollInto",e.options[a]),i.value=t;const l=Date.now();l-g>de&&(g=l,v=t)},M=()=>{if(f())return;const c=i.value-v,t=Date.now()-g;if(t<de&&Math.abs(c)>Ge){B(c,t);return}const l=T(i.value);h.value=ue,C(l),setTimeout(()=>{r=!1},0)},D=()=>{const c={height:`${e.optionHeight}px`};return e.options.map((t,a)=>{const l=t[e.fields.text],{disabled:V}=t,$=t[e.fields.value],ke={role:"button",style:c,tabindex:V?-1:0,class:[W("item",{disabled:V,selected:$===e.value}),t.className],onClick:()=>_(a)},xe={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:l};return d("li",ke,[o.option?o.option(t,a):d("div",xe,null)])})};return me(Ce),_e({stopMomentum:w}),De(()=>{const c=r?Math.floor(-i.value/e.optionHeight):e.options.findIndex(l=>l[e.fields.value]===e.value),t=U(e.options,c),a=-t*e.optionHeight;r&&t<c&&w(),i.value=a}),ve("touchmove",P,{target:m}),()=>d("div",{ref:m,class:W(),onTouchstartPassive:H,onTouchend:M,onTouchcancel:M},[d("ul",{ref:y,style:{transform:`translate3d(0, ${i.value+I()}px, 0)`,transitionDuration:`${h.value}ms`,transitionProperty:h.value?"all":"none"},class:W("wrapper"),onTransitionend:w},[D()])])}});const[Qe]=R("picker-toolbar"),K={title:String,cancelButtonText:String,confirmButtonText:String},We=["cancel","confirm","title","toolbar"],Xe=Object.keys(K);var Ze=q({name:Qe,props:K,emits:["confirm","cancel"],setup(e,{emit:n,slots:o}){const r=()=>{if(o.title)return o.title();if(e.title)return d("div",{class:[k("title"),"van-ellipsis"]},[e.title])},s=()=>n("cancel"),g=()=>n("confirm"),v=()=>{const m=e.cancelButtonText||ce("cancel");return d("button",{type:"button",class:[k("cancel"),ie],onClick:s},[o.cancel?o.cancel():m])},u=()=>{const m=e.confirmButtonText||ce("confirm");return d("button",{type:"button",class:[k("confirm"),ie],onClick:g},[o.confirm?o.confirm():m])};return()=>d("div",{class:k("toolbar")},[o.toolbar?o.toolbar():[v(),r(),u()]])}});const[et,wt]=R("picker-group"),tt=Symbol(et);N({tabs:L(),activeTab:F(0),nextStepText:String},K);const nt=N({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:F(44),showToolbar:he,swipeDuration:F(1e3),visibleOptionNum:F(6)},K),ot=N({},nt,{columns:L(),modelValue:L(),toolbarPosition:ge("top"),columnsFieldNames:Object});var at=q({name:qe,props:ot,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:n,slots:o}){const r=b(),s=b(e.modelValue.slice(0)),{parent:g}=me(tt),{children:v,linkChildren:u}=Te(Ce);u();const m=p(()=>ze(e.columnsFieldNames)),y=p(()=>Se(e.optionHeight)),i=p(()=>Ke(e.columns,m.value)),h=p(()=>{const{columns:t}=e;switch(i.value){case"multiple":return t;case"cascade":return Ye(t,m.value,s);default:return[t]}}),x=p(()=>h.value.some(t=>t.length)),O=p(()=>h.value.map((t,a)=>Z(t,s.value[a],m.value))),I=p(()=>h.value.map((t,a)=>t.findIndex(l=>l[m.value.value]===s.value[a]))),C=(t,a)=>{if(s.value[t]!==a){const l=s.value.slice(0);l[t]=a,s.value=l}},f=()=>({selectedValues:s.value.slice(0),selectedOptions:O.value,selectedIndexes:I.value}),_=(t,a)=>{C(a,t),i.value==="cascade"&&s.value.forEach((l,V)=>{const $=h.value[V];re($,l,m.value)||C(V,$.length?$[0][m.value.value]:void 0)}),te(()=>{n("change",N({columnIndex:a},f()))})},T=(t,a)=>{const l={columnIndex:a,currentOption:t};n("clickOption",N(f(),l)),n("scrollInto",l)},S=()=>{v.forEach(a=>a.stopMomentum());const t=f();return te(()=>{n("confirm",t)}),t},B=()=>n("cancel",f()),w=()=>h.value.map((t,a)=>d(Je,{value:s.value[a],fields:m.value,options:t,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:y.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:l=>_(l,a),onClickOption:l=>T(l,a),onScrollInto:l=>{n("scrollInto",{currentOption:l,columnIndex:a})}},{option:o.option})),H=t=>{if(x.value){const a={height:`${y.value}px`},l={backgroundSize:`100% ${(t-y.value)/2}px`};return[d("div",{class:k("mask"),style:l},null),d("div",{class:[Le,k("frame")],style:a},null)]}},P=()=>{const t=y.value*+e.visibleOptionNum,a={height:`${t}px`};return d("div",{ref:r,class:k("columns"),style:a},[w(),H(t)])},M=()=>{if(e.showToolbar&&!g)return d(Ze,Ne(ee(e,Xe),{onConfirm:S,onCancel:B}),ee(o,We))};z(h,t=>{t.forEach((a,l)=>{a.length&&!re(a,s.value[l],m.value)&&C(l,be(a)[m.value.value])})},{immediate:!0});let D;return z(()=>e.modelValue,t=>{!j(t,s.value)&&!j(t,D)&&(s.value=t.slice(0),D=t.slice(0))},{deep:!0}),z(s,t=>{j(t,e.modelValue)||(D=t.slice(0),n("update:modelValue",D))},{immediate:!0}),ve("touchmove",fe,{target:r}),_e({confirm:S,getSelectedOptions:()=>O.value}),()=>{var t,a;return d("div",{class:k()},[e.toolbarPosition==="top"?M():null,e.loading?d(Pe,{class:k("loading")},null):null,(t=o["columns-top"])==null?void 0:t.call(o),P(),(a=o["columns-bottom"])==null?void 0:a.call(o),e.toolbarPosition==="bottom"?M():null])}}});const lt=pe(at),[st,it]=R("divider"),ct={dashed:Boolean,hairline:he,vertical:Boolean,contentPosition:ge("center")};var rt=q({name:st,props:ct,setup(e,{slots:n}){return()=>{var o;return d("div",{role:"separator",class:it({dashed:e.dashed,hairline:e.hairline,vertical:e.vertical,[`content-${e.contentPosition}`]:!!n.default&&!e.vertical})},[!e.vertical&&((o=n.default)==null?void 0:o.call(n))])}}});const ut=pe(rt);const dt={class:"video-page-header"},mt={class:"video-page-container"},vt={class:"video-container"},ft=["src"],ht={class:"msg-panel"},gt={class:"course-title"},pt={class:"course-desc"},_t={key:0,class:"msg-panel"},bt={__name:"DiversityVideo",setup(e){const n=Be(),o=He(),r=Me(),s=b(!1),g=b(!0),v=b(!1);b(0);const u=$e({mSelectedValues:[0],selected:[0]}),m={text:"title",value:"index"},y=p({get(){return r.getters["common/getActivePage"]},set(f){r.dispatch("common/asyncUpdateActivePage",f)}}),i=p({get(){return r.getters["common/getCurrentVideo"]},set(f){r.dispatch("common/asyncCurrentVideo",f)}}),h=p(()=>i.value.episode.length<5?i.value.episode.length:5),x=()=>{o.push("/"+y.value)},O=({selectedValues:f})=>{v.value=!0},I=({selectedValues:f})=>{u.mSelectedValues=f,v.value=!1},C=()=>{v.value=!1};return Re(()=>{i.value.episode.forEach((f,_)=>{f.index=_}),u.selected=[n.query.episode_num?n.query.episode_num-1:0],u.mSelectedValues[0]=n.query.episode_num?n.query.episode_num-1:0}),(f,_)=>{const T=Ie,S=we,B=ut,w=lt,H=Ee;return J(),ne(Ae,null,[E("div",dt,[d(T,{title:i.value.title,"left-arrow":"",onClickLeft:x},null,8,["title"])]),E("div",mt,[E("div",vt,[E("iframe",{class:"video",src:i.value.episode[u.mSelectedValues[0]].url,scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true"}," ",8,ft)]),d(H,{loading:s.value,"onUpdate:loading":_[1]||(_[1]=P=>s.value=P),finished:g.value,"finished-text":"没有更多了"},{default:G(()=>[E("div",ht,[E("div",gt,[d(S,{name:"orders-o"}),oe(" "+Q(i.value.title)+" ",1),i.value.episode[u.mSelectedValues[0]].title?(J(),Fe(B,{key:0,vertical:"",style:{borderColor:"#000000"}})):ae("",!0),oe(" "+Q(i.value.episode[u.mSelectedValues[0]].title),1)]),E("p",pt,Q(i.value.episode[u.mSelectedValues[0]].desc),1)]),i.value.episode.length>1?(J(),ne("div",_t,[d(w,{columns:i.value.episode,"columns-field-names":m,title:"选集",modelValue:u.selected,"onUpdate:modelValue":_[0]||(_[0]=P=>u.selected=P),"visible-option-num":h.value,onChange:O,onConfirm:I,onCancel:C},{confirm:G(()=>[le(d(S,{name:"success"},null,512),[[se,v.value]])]),cancel:G(()=>[le(d(S,{name:"cross"},null,512),[[se,v.value]])]),_:1},8,["columns","modelValue","visible-option-num"])])):ae("",!0)]),_:1},8,["loading","finished"])])],64)}}},Pt=Ve(bt,[["__scopeId","data-v-6f0ffb39"]]);export{Pt as default};
